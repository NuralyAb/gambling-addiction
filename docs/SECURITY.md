# Безопасность и конфиденциальность

## Анонимизация перед OpenAI

**Файл:** `src/lib/anonymize.ts`

Перед отправкой в OpenAI маскируются:
- Email: `[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}` → `[email скрыт]`
- Телефоны: `+7`, `8`, российские форматы → `[телефон скрыт]`
- Длинные числовые последовательности (10–11 цифр) → `[номер скрыт]`

**Почему regex, а не полное удаление:** Сохраняется смысл сообщения («напиши на example@mail.ru» → «напиши на [email скрыт]»), но PII не уходит наружу.

---

## Хранение паролей

bcrypt, 12 раундов. Пароли не логируются и не передаются клиенту.

---

## Row Level Security (RLS)

В Supabase включён RLS. Политики настроены на `service_role` — доступ только с сервера через API. Прямой доступ клиента к БД отключён.

---

## Сроки хранения (Privacy Policy)

- Профиль, дневник, чат: пока действует аккаунт; при удалении — 30 дней
- События блокировки: 90 дней
- Серверные логи: 30 дней
- Логи админов: 1 год

---

## Админка

Доступ по `ADMIN_EMAIL` в .env (через запятую — несколько админов). Проверка на каждом запросе к `/api/admin/*` через `isAdmin(session)`.
